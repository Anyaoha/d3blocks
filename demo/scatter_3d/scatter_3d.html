<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://unpkg.com/d3-3d/build/d3-3d.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<body>
<svg width="960" height="500"></svg>
<style type="text/css">
button {
    position: absolute;
    right: 10px;
    top: 10px;
}
</style>
<button>update</button>
<script>
    var origin = [480, 300], j = 10, scale = 20, scatter = [], yLine = [], xGrid = [], beta = 0, alpha = 0, key = function(d){ return d.id; }, startAngle = Math.PI/4;
    var svg    = d3.select('svg').call(d3.drag().on('drag', dragged).on('start', dragStart).on('end', dragEnd)).append('g');
    var color  = d3.scaleOrdinal(d3.schemeCategory20);
    var mx, my, mouseX, mouseY;

    var grid3d = d3._3d()
        .shape('GRID', 20)
        .origin(origin)
        .rotateY( startAngle)
        .rotateX(-startAngle)
        .scale(scale);

    var point3d = d3._3d()
        .x(function(d){ return d.x; })
        .y(function(d){ return d.y; })
        .z(function(d){ return d.z; })
        .origin(origin)
        .rotateY( startAngle)
        .rotateX(-startAngle)
        .scale(scale);

    var yScale3d = d3._3d()
        .shape('LINE_STRIP')
        .origin(origin)
        .rotateY( startAngle)
        .rotateX(-startAngle)
        .scale(scale);

    function processData(data, tt){

        /* ----------- GRID ----------- */

        var xGrid = svg.selectAll('path.grid').data(data[0], key);

        xGrid
            .enter()
            .append('path')
            .attr('class', '_3d grid')
            .merge(xGrid)
            .attr('stroke', 'black')
            .attr('stroke-width', 0.3)
            .attr('fill', function(d){ return d.ccw ? 'lightgrey' : '#717171'; })
            .attr('fill-opacity', 0.9)
            .attr('d', grid3d.draw);

        xGrid.exit().remove();

        /* ----------- POINTS ----------- */

        var points = svg.selectAll('circle').data(data[1], key);

        points
            .enter()
            .append('circle')
            .attr('class', '_3d')
            .attr('opacity', 0)
            .attr('cx', posPointX)
            .attr('cy', posPointY)
            .merge(points)
            .transition().duration(tt)
            .attr('r', 3)
            .attr('stroke', function(d){ return d3.color(color(d.id)).darker(3); })
            .attr('fill', function(d){ return color(d.id); })
            .attr('opacity', 1)
            .attr('cx', posPointX)
            .attr('cy', posPointY);

        points.exit().remove();

        /* ----------- y-Scale ----------- */

        var yScale = svg.selectAll('path.yScale').data(data[2]);

        yScale
            .enter()
            .append('path')
            .attr('class', '_3d yScale')
            .merge(yScale)
            .attr('stroke', 'black')
            .attr('stroke-width', .5)
            .attr('d', yScale3d.draw);

        yScale.exit().remove();

         /* ----------- y-Scale Text ----------- */

        var yText = svg.selectAll('text.yText').data(data[2][0]);

        yText
            .enter()
            .append('text')
            .attr('class', '_3d yText')
            .attr('dx', '.3em')
            .merge(yText)
            .each(function(d){
                d.centroid = {x: d.rotated.x, y: d.rotated.y, z: d.rotated.z};
            })
            .attr('x', function(d){ return d.projected.x; })
            .attr('y', function(d){ return d.projected.y; })
            .text(function(d){ return d[1] <= 0 ? d[1] : ''; });

        yText.exit().remove();

        d3.selectAll('._3d').sort(d3._3d().sort);
    }

    function posPointX(d){
        return d.projected.x;
    }

    function posPointY(d){
        return d.projected.y;
    }

	function init(){
        var cnt = 0;
        xGrid = [], scatter = [], yLine = [];
		scatter=[{"x":-10,"y":-6.520997316254551,"z":-8,"id":"point_0"},{"x":-9,"y":-8.277427842018543,"z":-10,"id":"point_1"},{"x":-8,"y":-1.3513271117475778,"z":-10,"id":"point_2"},{"x":-7,"y":-8.128637231008264,"z":-10,"id":"point_3"},{"x":-6,"y":-7.236277217453663,"z":-10,"id":"point_4"},{"x":-5,"y":-0.9725182587355996,"z":-10,"id":"point_5"},{"x":-4,"y":-1.9754702750826225,"z":-10,"id":"point_6"},{"x":-3,"y":-6.246745240017731,"z":-10,"id":"point_7"},{"x":-2,"y":-6.330246997338575,"z":-10,"id":"point_8"},{"x":-1,"y":-1.0946454195530397,"z":-10,"id":"point_9"}]
		//scatter = [{"x":-10,"y":-9.024888777456741,"z":-8,"id":"point_0"},{"x":-9,"y":-7.212113163829024,"z":-10,"id":"point_1"},{"x":-8,"y":-2.4444787261883416,"z":-10,"id":"point_2"},{"x":-7,"y":-7.123306023102296,"z":-10,"id":"point_3"},{"x":-6,"y":-0.11289303272761009,"z":-10,"id":"point_4"},{"x":-5,"y":-7.329586814664935,"z":-10,"id":"point_5"},{"x":-4,"y":-3.97563917806268,"z":-10,"id":"point_6"},{"x":-3,"y":-4.4077678709301304,"z":-10,"id":"point_7"},{"x":-2,"y":-1.4713420752852402,"z":-10,"id":"point_8"},{"x":-1,"y":-4.753750771309186,"z":-10,"id":"point_9"},{"x":0,"y":-0.8148816636275114,"z":-10,"id":"point_10"},{"x":1,"y":-1.835089044543634,"z":-10,"id":"point_11"},{"x":2,"y":-3.3539526908580664,"z":-10,"id":"point_12"},{"x":3,"y":-7.233458468891339,"z":-10,"id":"point_13"},{"x":4,"y":-0.6902205820799834,"z":-10,"id":"point_14"},{"x":5,"y":-0.1887496389637544,"z":-10,"id":"point_15"},{"x":6,"y":-5.970942441575815,"z":-10,"id":"point_16"},{"x":7,"y":-4.261876275217666,"z":-10,"id":"point_17"},{"x":8,"y":-9.490458998868407,"z":-10,"id":"point_18"},{"x":9,"y":-4.423444191110802,"z":-10,"id":"point_19"},{"x":-10,"y":-7.256063493127865,"z":-9,"id":"point_20"},{"x":-9,"y":-7.410643646911486,"z":-9,"id":"point_21"},{"x":-8,"y":-9.06031833740622,"z":-9,"id":"point_22"},{"x":-7,"y":-6.3274287978962995,"z":-9,"id":"point_23"},{"x":-6,"y":-8.73638343844932,"z":-9,"id":"point_24"},{"x":-5,"y":-9.557965448812437,"z":-9,"id":"point_25"},{"x":-4,"y":-1.578290478478237,"z":-9,"id":"point_26"},{"x":-3,"y":-6.828851039054598,"z":-9,"id":"point_27"},{"x":-2,"y":-8.825923685347117,"z":-9,"id":"point_28"},{"x":-1,"y":-6.092264451262405,"z":-9,"id":"point_29"},{"x":0,"y":-6.224241132454404,"z":-9,"id":"point_30"},{"x":1,"y":-6.805146534886379,"z":-9,"id":"point_31"},{"x":2,"y":-5.737474726049587,"z":-9,"id":"point_32"},{"x":3,"y":-4.0229074385513925,"z":-9,"id":"point_33"},{"x":4,"y":-2.3110816590638072,"z":-9,"id":"point_34"},{"x":5,"y":-2.532037631694517,"z":-9,"id":"point_35"},{"x":6,"y":-9.493483942648265,"z":-9,"id":"point_36"},{"x":7,"y":-0.6904287750714189,"z":-9,"id":"point_37"},{"x":8,"y":-7.6676299000667765,"z":-9,"id":"point_38"},{"x":9,"y":-4.200000457406836,"z":-9,"id":"point_39"},{"x":-10,"y":-2.5049161163027422,"z":-8,"id":"point_40"},{"x":-9,"y":-0.21024844967308942,"z":-8,"id":"point_41"},{"x":-8,"y":-5.945734816850788,"z":-8,"id":"point_42"},{"x":-7,"y":-9.139576501574673,"z":-8,"id":"point_43"},{"x":-6,"y":-7.594120146900202,"z":-8,"id":"point_44"},{"x":-5,"y":-3.6274569821580793,"z":-8,"id":"point_45"},{"x":-4,"y":-1.9233580656976978,"z":-8,"id":"point_46"},{"x":-3,"y":-2.67065306074749,"z":-8,"id":"point_47"},{"x":-2,"y":-1.2856082131458635,"z":-8,"id":"point_48"},{"x":-1,"y":-5.533560407924901,"z":-8,"id":"point_49"},{"x":0,"y":-8.805694934794088,"z":-8,"id":"point_50"}]
		var min_z = d3.min(scatter, s => s.z)
		var max_z = d3.max(scatter, s => s.z)
		var min_x = d3.min(scatter, s => s.x)
		var max_x = d3.max(scatter, s => s.x)

		//var min_z = -j
		//var max_z = j
		//var min_x = -j
		//var max_x = j

		for(var z = min_z; z < max_z; z++){
            for(var x = min_x; x < max_x; x++){
                xGrid.push([x, 1, z]);
                //scatter.push({x: x, y: d3.randomUniform(0, -10)(), z: z, id: 'point_' + cnt++});
            }
        }

		//xGrid = [[-10,1,-10],[-9,1,-10],[-8,1,-10],[-7,1,-10],[-6,1,-10],[-5,1,-10],[-4,1,-10],[-3,1,-10],[-2,1,-10],[-1,1,-10],[0,1,-10],[1,1,-10],[2,1,-10],[3,1,-10],[4,1,-10]]

        d3.range(-1, 11, 1).forEach(function(d){ yLine.push([-j, -d, -j]); });
		console.log(JSON.stringify(scatter), min_z, max_z, min_x, max_x)
		console.log(JSON.stringify(yLine))

        var data = [
            grid3d(xGrid),
            point3d(scatter),
            yScale3d([yLine])
        ];
        processData(data, 1000);
    }

    function dragStart(){
        mx = d3.event.x;
        my = d3.event.y;
    }

    function dragged(){
        mouseX = mouseX || 0;
        mouseY = mouseY || 0;
        beta   = (d3.event.x - mx + mouseX) * Math.PI / 230 ;
        alpha  = (d3.event.y - my + mouseY) * Math.PI / 230  * (-1);
        var data = [
             grid3d.rotateY(beta + startAngle).rotateX(alpha - startAngle)(xGrid),
            point3d.rotateY(beta + startAngle).rotateX(alpha - startAngle)(scatter),
            yScale3d.rotateY(beta + startAngle).rotateX(alpha - startAngle)([yLine]),
        ];
        processData(data, 0);
    }

    function dragEnd(){
        mouseX = d3.event.x - mx + mouseX;
        mouseY = d3.event.y - my + mouseY;
    }

    d3.selectAll('button').on('click', init);

    init();
</script>
</body>
